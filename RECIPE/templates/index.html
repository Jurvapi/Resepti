<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What Should I Eat Today? üê∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f8e1ff 0%, #e1f4fd 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: #8b5a9f;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .time-greeting {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .decision-helper {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(139,90,159,0.1);
            margin-bottom: 30px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .decision-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .btn-surprise {
            background: linear-gradient(45deg, #ffd1dc, #ffb3c1);
            color: #8b5a9f;
        }
        
        .btn-quick {
            background: linear-gradient(45deg, #b8f2ff, #a0e7e5);
            color: #5a8b8f;
        }
        
        .btn-breakfast {
            background: linear-gradient(45deg, #ffe4b5, #ffd180);
            color: #8b6f47;
        }
        
        .btn-lunch {
            background: linear-gradient(45deg, #c8e6c9, #a5d6a7);
            color: #4a6741;
        }
        
        .btn-dinner {
            background: linear-gradient(45deg, #e1bee7, #d1c4e9);
            color: #6a4c93;
        }
        
        .btn-snack {
            background: linear-gradient(45deg, #fff9c4, #ffecb3);
            color: #8b7d3a;
        }
        
        .decision-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .search-section {
            margin-bottom: 30px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        
        .search-btn {
            background: linear-gradient(45deg, #c5cae9, #b39ddb);
            color: #5a4fcf;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
        }
        
        .recipe-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }
        
        .recipe-title {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        
        .recipe-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .ingredients {
            margin-bottom: 20px;
        }
        
        .ingredients-list {
            list-style: none;
            padding: 0;
        }
        
        .ingredients-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .ingredients-list li::before {
            content: "üêæ ";
            margin-right: 10px;
        }
        
        .instructions {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #b39ddb;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
            background: #ffeaea;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .recipe-meta {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üê∞ What Should I Eat Today?</h1>
            <p class="time-greeting">{{ time_greeting }}</p>
        </div>
        
        <div class="decision-helper">
            <h2 style="text-align: center; margin-bottom: 25px; color: #8b5a9f;">
                Can't decide? Let me help! üê±
            </h2>
            
            <div class="button-grid">
                <button class="decision-btn btn-surprise" onclick="getSurpriseRecipe()">
                    üêπ Surprise Me!
                </button>
                <button class="decision-btn btn-quick" onclick="getQuickRecipe()">
                    üê∞ Something Quick (‚â§10 min)
                </button>
                <button class="decision-btn btn-breakfast" onclick="getCategoryRecipe('breakfast')">
                    üêπ Breakfast
                </button>
                <button class="decision-btn btn-lunch" onclick="getCategoryRecipe('lunch')">
                    üê∏ Lunch
                </button>
                <button class="decision-btn btn-dinner" onclick="getCategoryRecipe('dinner')">
                    üêª Dinner
                </button>
                <button class="decision-btn btn-snack" onclick="getCategoryRecipe('snacks')">
                    üêøÔ∏è Snack
                </button>
            </div>
            
            <div class="search-section">
                <h3 style="margin-bottom: 15px; color: #8b5a9f;">
                    üê± Or search for something specific:
                </h3>
                <input type="text" id="searchInput" class="search-input" 
                       placeholder="Search by ingredient or recipe name (e.g., 'chicken', 'pasta', 'quick')...">
                <button class="search-btn" onclick="searchRecipes()">Search</button>
            </div>
            
            <div id="recipeDisplay" class="recipe-display"></div>
        </div>
    </div>

    <script>
        function showLoading() {
            const display = document.getElementById('recipeDisplay');
            display.style.display = 'block';
            display.innerHTML = '<div class="loading">üê∞ Cooking up a suggestion...</div>';
        }
        
        function showError(message) {
            const display = document.getElementById('recipeDisplay');
            display.style.display = 'block';
            display.innerHTML = `<div class="error">ÔøΩ ${message}</div>`;
        }
        
        function displayRecipe(recipe) {
            const display = document.getElementById('recipeDisplay');
            
            const categoryEmoji = {
                'breakfast': 'ü•ê',
                'lunch': 'ü•ó', 
                'dinner': 'üçù',
                'snacks': 'üçø'
            };
            
            const difficultyColor = {
                'Easy': '#4caf50',
                'Medium': '#ff9800',
                'Hard': '#f44336'
            };
            
            display.innerHTML = `
                <h3 class="recipe-title">
                    ${categoryEmoji[recipe.category] || 'üê∞'} ${recipe.name}
                </h3>
                <div class="recipe-meta">
                    <span class="meta-item">üê∞ ${recipe.time} minutes</span>
                    <span class="meta-item" style="background-color: ${difficultyColor[recipe.difficulty]}20; color: ${difficultyColor[recipe.difficulty]}">
                        ÔøΩ ${recipe.difficulty}
                    </span>
                    <span class="meta-item">üêæ ${recipe.category}</span>
                </div>
                <div class="ingredients">
                    <h4 style="margin-bottom: 10px; color: #8b5a9f;">Ingredients:</h4>
                    <ul class="ingredients-list">
                        ${recipe.ingredients.map(ingredient => `<li>${ingredient}</li>`).join('')}
                    </ul>
                </div>
                <div class="instructions">
                    <h4 style="margin-bottom: 10px; color: #8b5a9f;">Instructions:</h4>
                    <p>${recipe.instructions}</p>
                </div>
            `;
            display.style.display = 'block';
        }
        
        function displaySearchResults(recipes) {
            const display = document.getElementById('recipeDisplay');
            
            if (recipes.length === 0) {
                showError("No recipes found. Try searching for 'chicken', 'quick', or 'pasta'!");
                return;
            }
            
            if (recipes.length === 1) {
                displayRecipe(recipes[0]);
                return;
            }
            
            // Multiple results - show all
            const categoryEmoji = {
                'breakfast': 'üêπ',
                'lunch': 'üê∏', 
                'dinner': 'üêª',
                'snacks': 'üêøÔ∏è'
            };
            
            display.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #8b5a9f;">
                    Found ${recipes.length} recipes! Pick one:
                </h3>
                <div style="display: grid; gap: 15px;">
                    ${recipes.map((recipe, index) => `
                        <div style="background: white; padding: 20px; border-radius: 8px; cursor: pointer; border: 2px solid #eee; transition: all 0.3s ease;" 
                             onmouseover="this.style.borderColor='#b39ddb'" 
                             onmouseout="this.style.borderColor='#eee'"
                             onclick="displaySingleRecipe(${index})">
                            <h4 style="color: #8b5a9f; margin-bottom: 10px;">
                                ${categoryEmoji[recipe.category] || 'üê∞'} ${recipe.name}
                            </h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <span style="background: #f1f3f4; padding: 4px 8px; border-radius: 10px; font-size: 0.85em;">
                                    üê∞ ${recipe.time}min
                                </span>
                                <span style="background: #f1f3f4; padding: 4px 8px; border-radius: 10px; font-size: 0.85em;">
                                    üê± ${recipe.difficulty}
                                </span>
                                <span style="background: #f1f3f4; padding: 4px 8px; border-radius: 10px; font-size: 0.85em;">
                                    üêæ ${recipe.category}
                                </span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            display.style.display = 'block';
            
            // Store recipes for click handlers
            window.searchResultRecipes = recipes;
        }
        
        function displaySingleRecipe(index) {
            const recipe = window.searchResultRecipes[index];
            displayRecipe(recipe);
        }
        
        async function getSurpriseRecipe() {
            showLoading();
            try {
                const response = await fetch('/random-recipe');
                const recipe = await response.json();
                displayRecipe(recipe);
            } catch (error) {
                showError('Oops! Something went wrong. Try again!');
            }
        }
        
        async function getQuickRecipe() {
            showLoading();
            try {
                const response = await fetch('/quick-recipes');
                const recipe = await response.json();
                displayRecipe(recipe);
            } catch (error) {
                showError('No quick recipes available right now!');
            }
        }
        
        async function getCategoryRecipe(category) {
            showLoading();
            try {
                const response = await fetch(`/recipe/${category}`);
                const recipe = await response.json();
                displayRecipe(recipe);
            } catch (error) {
                showError(`No ${category} recipes available right now!`);
            }
        }
        
        async function searchRecipes() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                showError('Please enter something to search for! üê±');
                return;
            }
            
            showLoading();
            try {
                const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                const recipes = await response.json();
                displaySearchResults(recipes);
            } catch (error) {
                showError('Search failed. Try again!');
            }
        }
        
        // Allow searching with Enter key
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchRecipes();
            }
        });
        
        // Show suggested meal type recipe on load
        {% if suggested_meal %}
        window.addEventListener('load', function() {
            // Auto-suggest based on time of day after 2 seconds
            setTimeout(() => {
                if (!document.getElementById('recipeDisplay').style.display || 
                    document.getElementById('recipeDisplay').style.display === 'none') {
                    getCategoryRecipe('{{ suggested_meal }}');
                }
            }, 2000);
        });
        {% endif %}
    </script>
</body>
</html>